---
title: 使用 Composition API 开发
date: 2023-07-12 17:56:58
permalink: /pages/50f585/
article: false
---
Composition API 是 Vue3 全新提供的一种语法，相比之前的 Options API，Composition API 更加灵活，可复用性更高，可以更好地组织代码和逻辑。一些通用的代码逻辑可以封装成hooks。

:::tip
对于从 Vue2 就在使用的开发者，如果一时半会没办法立马上手 Composition API ，你依旧可以在项目中使用 Options API 做开发。当然我们更建议你使用 Composition API 进行开发，它比 Options API 更灵活且易读。
:::

## 使用
如果你还不熟悉 `Composition API` ，那么我们建议你阅读 `Vue3` 官方文档了解；如果你已经熟悉 `Composition API` ，那么我们建议你在开发的时候，使用 `<script setup>` 语法糖进行开发，它将提高很多开发效率。

同时得益于 `unplugin-auto-import` 的特性，在 `<script setup>` 里无需导入相关 `API` ，该依赖会自动导入（默认支持 `vue`，`vue-router` 和 `pinia` ）。

```js
<script setup lang="ts">
    // 无需手动 import 引入 相关 API
    
    const state = reactive({
        name:'Mr zhang',
        age:'18'
    })
    const count = ref(0)
    const doubled = computed(() => count.value * 2)
    watch(()=>count.value,(newVal,oldVal)=>{
    
    })
    onMounted(()=>{
    
    })
    const route = useRoute()
    const router = useRouter()
    console.log(route.path)
    router.push('/dashboard')
</script>
```
## 组件 name
`<script setup>` 可以和普通的 `<script>` 一起使用，所以可以这样定义组件 name：
```js
<script lang="ts">
export default {
  name: 'componentName',
}
</script>

<script setup lang="ts">
...
</script>
```
`Vue 3.3` 开始，你可以使用 `defineOptions` 在 `<script setup>` 里定义组件的 `name`：
```js
<script setup lang="ts" name='componentName'>
    
</script>
```
## vue3常用API

* `defineAsyncComponent`: 用于异步加载组件，可以在需要时才进行组件的加载和注册。
* `onBeforeRouteLeave`: 在离开当前路由前执行，可以用来做一些确认提示等操作。
* `markRaw`: 标记一个响应式对象，使其不会被响应式系统代理，可以提高性能。
* `isRef`: 判断一个对象是否为 ref 对象。
* `toRef`: 将一个响应式对象的属性转换为一个 ref 对象。
* `toRefs`: 将一个响应式对象的所有属性转换为 ref 对象。
* `computed`: 用于创建一个计算属性，它的值会根据它所依赖的响应式对象自动更新。
* `onMounted`: 在组件挂载后立即执行的生命周期函数。
* `onUpdated`: 在组件更新后立即执行的生命周期函数。
* `onUnmounted`: 在组件卸载时执行的生命周期函数。
* `watchEffect`: 监听响应式数据的变化并执行回调函数。
* `watch`: 监听某个响应式对象的变化并执行回调函数。
* `watchRef`: 监听一个 ref 对象的变化并执行回调函数。
* `watchEffectOnce`: 仅监听一次响应式数据的变化并执行回调函数。
* `provide/inject`: 用于父子组件之间的数据传递。
* `h`: 用于创建虚拟节点，是 Vue 3 中的 createElement 方法的别名。
* `ref`: 创建一个 ref 对象，用于对基本数据类型进行响应式处理。
* `reactive`: 创建一个响应式对象，用于对普通对象进行响应式处理。
* `readonly`: 创建一个只读的响应式对象。
* `shallowReactive`: 创建一个浅层响应式对象，只对对象的第一层属性进行响应式处理。
* `shallowRef`: 创建一个浅层的 ref 对象，只对基本数据类型进行响应式处理。
