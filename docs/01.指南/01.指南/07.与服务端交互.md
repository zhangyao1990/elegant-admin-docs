---
title: 与服务端交互
date: 2023-07-12 11:16:18
permalink: /pages/d0d7eb/
article: false
---
框架使用 [Axios](https://www.axios-http.cn/) 做为异步请求工具，并进行了封装。

## 接口请求

### 设置 baseURL

在根目录 .env.* 文件里的 VITE_APP_MODE 这个参数就是配置当前环境 。

然后在/src/api/config/servicePort.ts通过环境判断,请求不同的地址及服务。

```js
// * 后端接口请求地址1
const BASEURL1: any = {
	dev: '/nethos/admin',
	test: 'https://xxxxxxx.cn/nethos/admin',
	prod: 'https://xxxxxxx.cn/nethos/admin'
};
// * 后端接口请求地址2
const BASEURL2: any = {
	dev: '/nethos/minio',
	test: 'https://xxxxxxx.cn/nethos/minio',
	prod: 'https://xxxxxxx.cn/nethos/minio',
};
export const PORT1 = BASEURL1[import.meta.env.VITE_APP_MODE];
export const PORT2 = BASEURL2[import.meta.env.VITE_APP_MODE];

```

### 请求调用
常用的 GET、POST、PUT、DELETE 请求可使用以下的方法：

```js
import { ResPage } from '@/api/interface';
import { User } from '@/api/interface/sys_user';
import { PORT1 } from '@/api/config/servicePort';

import http from '@/api';

/********** 用户管理模块 ***********/
// * 获取用户列表
export const getSysUserListApi = (params: User.ReqGetUserParams) => {
	return http.post<ResPage<User.ResUserList>>(PORT1 + `/sysUser/page`, params);
};

// * 新增用户
export const addUserApi = (params: any) => {
	return http.post<any>(PORT1 + `/sysUser/save`, params);
};

// * 编辑用户
export const editUserApi = (params: any) => {
	return http.put<any>(PORT1 + `/sysUser/update`, params);
};
// * 用户详情
export const getSysUserDetailApi = (params: any) => {
	return http.get<any>(PORT1 + `/sysUser/${params.id}`, params);
};
// * 删除用户
export const delSysUserApi = (params: { id: string }) => {
	return http.delete<any>(PORT1 + `/sysUser/delete`, params);
};

```
### 拦截器

在 /src/api/index.ts 文件里实例化了 axios 对象，并对 request 和 response 设置了拦截器，拦截器的用处就是拦截每一次的请求和响应，然后做一些全局的处理。例如接口响应报错，可以在拦截器里用统一的报错提示来展示，方便业务开发。

首先初始化 axios 对象，然后 axios.interceptors.request.use() 和 axios.interceptors.response.use() 就分别是请求和响应的拦截代码了。

请求的时候会自动带上 token ，响应的时候会根据错误信息判断是登录失效还是接口报错，并做相应动作。

### 模块管理

如果项目里的接口很多，推荐根据模块来统一管理接口，目录为 /src/api/modules/ 。

### 跨域处理

生产环境的跨域需要服务端去解决，开发环境的跨域问题可在本地设置代理解决。如果本地开发环境请求接口提示跨域,可以开启代理。

开启代理后，原有请求都会被指向到本地 http://localhost:3000/nethos ，因为 /nethos 匹配到了 vite.config.ts 里代理部分的设置，所以实际是请求依旧是所设置的地址。

```base
	server: {
        port: 3000,
        host: '0.0.0.0',
        proxy: {
            '/nethos': {
                target: 'https://xxxxxxx.cn/',
                changeOrigin: true,
                rewrite: path => path.replace(/^\/nethos/, 'nethos')
            },
             '/nethos2': {
                target: 'https://xxxxxxx.cn/',
                changeOrigin: true,
                rewrite: path => path.replace(/^\/nethos2/, 'nethos2')
            }
        }
    }
```

::: warning 注意⚠️

需注意，如果第二个数据源也需要开启跨域处理的话，需要在 /src/api/config/servicePort.ts 里定一个新的 nethos2 路径，例如 /nethos2/ ：

:::

