---
title: 全局状态管理
date: 2023-07-13 18:56:22
permalink: /pages/197691/
article: false
---

## [全新的 Vue3 状态管理工具：Pinia](https://pinia.vuejs.org/zh/)

使用 Pinia 替代 Vuex，Pinia 是一个基于 Vue3 的轻量级状态管理库，与 Vuex 相比，它提供了更加简单易用的 API，并且可以支持 TypeScript 类型定义。相对于 Vuex 复杂的模块化结构，Pinia 的代码结构更加扁平化，易于理解和维护。使用 Pinia 可以通过创建 store 实例来管理全局状态，使用 Pinia 可以有效减少状态管理的维护成本，并提供了更加清晰、简单的代码结构。（使用$patch改变数据 $patch 可以同时修改多个值）。

全局状态文件存放在 /src/store/modules/ 目录下，请按模块进行区分。同时请保证文件名和文件内唯一ID保持一致，建议使用 pnpm new 指令进行创建。

例如新建一个 user.ts 的文件：
```js
const useUserStore = defineStore(
    // 唯一ID
    'user',
    () => {
        const settingsStore = useSettingsStore()
        const routeStore = useRouteStore()
        const menuStore = useMenuStore()

        const account = ref<string>(getLocal('account') ?? '')
        const token = ref<string | null | undefined>(getLocal('token') ?? '')
        const avatar = ref<string>(getLocal('avatar') ?? '')
        const permissions = ref<string[]>([])
        const isLogin = computed(() => {
            if (token.value) {
                return true
            }
            return false
        })

        // 登录
        async function login(data: ReqLoginForm) {
            const res = await loginApi(data)
            setLocal('account', res.data.account)
            setLocal('token', res.data.token)
            setLocal('avatar', res.data.avatar)
            account.value = res.data.account
            token.value = res.data.token
            avatar.value = res.data.avatar
        }
        // 登出
        async function logout(redirect = router.currentRoute.value.fullPath) {
            removeLocal('account')
            removeLocal('token')
            removeLocal('avatar')
            account.value = ''
            token.value = ''
            avatar.value = ''
            permissions.value = []
            routeStore.removeRoutes()
            menuStore.setActived(0)
            router.push({
                name: 'login',
                query: {
                    ...(router.currentRoute.value.path !== settingsStore.settings.home.fullPath && router.currentRoute.value.name !== 'login' && { redirect }),
                },
            })
        }
        // 获取权限
        async function getPermissions() {
            const res = await getAuthPermissionListApi()
            permissions.value = res.data.permissions
        }
        // 修改密码
        async function editPassword(data: {
            password: string
            newpassword: string
        }) {
            await editPasswordApi(data)
        }

        return {
            account,
            token,
            avatar,
            permissions,
            isLogin,
            login,
            logout,
            getPermissions,
            editPassword,
        }
    },
)

export default useUserStore


```
使用方法：
```js

import useUserStore from '@/store/modules/user'
const userStore = useUserStore()

userStore.data
userStore.getPermissions()

```
