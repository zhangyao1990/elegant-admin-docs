---
title: æ‰“åŒ…å’Œéƒ¨ç½²
date: 2023-07-12 09:50:07
permalink: /pages/574c7a/
article: false
---

## æµ‹è¯•ç¯å¢ƒæ‰“åŒ…

```bash
  pnpm run build:test
```
## é¢„å‘å¸ƒç¯å¢ƒæ‰“åŒ…

```bash
  pnpm run build:pre
```
## ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…

```bash
  pnpm run build:pro
```

æ„å»ºæ‰“åŒ…æˆåŠŸä¹‹åï¼Œä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆ dist æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å°±æ˜¯æ„å»ºæ‰“åŒ…å¥½çš„æ–‡ä»¶ã€‚

## æœ¬åœ°é¢„è§ˆ
ç”Ÿæˆå¥½çš„ dist æ–‡ä»¶å¤¹ä¸€èˆ¬éœ€è¦éƒ¨ç½²è‡³æœåŠ¡å™¨æ‰ç®—éƒ¨ç½²å‘å¸ƒæˆåŠŸï¼Œä½†ä¸ºäº†ä¿è¯æ„å»ºå‡ºæ¥çš„æ–‡ä»¶èƒ½æ­£å¸¸è¿è¡Œï¼Œå¼€å‘è€…é€šå¸¸å¸Œæœ›èƒ½åœ¨æœ¬åœ°å…ˆé¢„è§ˆä¸€ä¸‹ï¼Œå¯æ‰§è¡Œ pnpm run serve:test å‘½ä»¤é¢„è§ˆæ„å»ºå‡ºçš„æ–‡ä»¶å¤¹ã€‚

## æ‰“åŒ…åˆ†æ
``` bash
pnpm report
```
## éƒ¨ç½²
æ¯”å¦‚æˆ‘ä»¬åœ¨ vite.config.ts é…ç½®äº†ä¸¤ä¸ªåç«¯åœ°å€ï¼Œå¦‚ä¸‹

```js

proxy: {
    '/nethos': {
        target: 'http://127.0.0.1:3000/',
            changeOrigin: true,
            rewrite: path => path.replace(/^\/nethos/, 'nethos')
    }
    '/otherApi': {
    	target: 'http://127.0.0.1:9000',
    	changeOrigin: true,
    	rewrite: path => path.replace(/^\/otherApi/, 'otherApi')
    }
}
```
æ¥åˆ° /usr/local/etc/nginx/nginx.conf è¿™ä¸ª nginx çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æˆå¦‚ä¸‹é…ç½®å³å¯

```bash
location / {
    root   html;
    index  index.html index.htm;
    # ç”¨äºé…åˆå‰ç«¯è·¯ç”±ä¸ºh5æ¨¡å¼ä½¿ç”¨ï¼Œé˜²æ­¢åˆ·æ–°404 https://router.vuejs.org/zh/guide/essentials/history-mode.html#nginx
    try_files $uri $uri/ /index.html;
}

# ç¬¬ä¸€ä¸ªä»£ç†åç«¯åœ°å€ï¼ˆvite.config.tsé‡Œå« /apiï¼Œè¿™é‡Œä¹Ÿè¦ä¿æŒä¸€è‡´ï¼‰
location /nethos {
    # å¦‚æœåç«¯åœ¨æœ¬åœ°æ¯”å¦‚127.0.0.1æˆ–è€…localhostè¯·è§£å¼€ä¸‹é¢çš„rewriteæ³¨é‡Šå³å¯
    # rewrite  ^.+nethos/?(.*)$ /$1 break;
    # è¿™é‡Œå¡«å†™åç«¯åœ°å€ï¼ˆåé¢ä¸€å®šä¸è¦å¿˜è®°æ·»åŠ  / ï¼‰
    proxy_pass http://127.0.0.1:3000/;
    proxy_set_header Host $host;
    proxy_set_header Cookie $http_cookie;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_redirect default;
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Headers X-Requested-With;
    add_header Access-Control-Allow-Methods GET,POST,OPTIONS;
}

# ç¬¬äºŒä¸ªä»£ç†åç«¯åœ°å€ï¼ˆvite.config.tsé‡Œå« /otherApiï¼Œè¿™é‡Œä¹Ÿè¦ä¿æŒä¸€è‡´ï¼‰
location /otherApi {
    # å¦‚æœåç«¯åœ¨æœ¬åœ°æ¯”å¦‚127.0.0.1æˆ–è€…localhostè¯·è§£å¼€ä¸‹é¢çš„rewriteæ³¨é‡Šå³å¯
    # rewrite  ^.+otherApi/?(.*)$ /$1 break;
    # è¿™é‡Œå¡«å†™åç«¯åœ°å€ï¼ˆåé¢ä¸€å®šä¸è¦å¿˜è®°æ·»åŠ  / ï¼‰
    proxy_pass http://127.0.0.1:9000/;
    proxy_set_header Host $host;
    proxy_set_header Cookie $http_cookie;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_redirect default;
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Headers X-Requested-With;
    add_header Access-Control-Allow-Methods GET,POST,OPTIONS;
}
```
å°†ä¸Šé¢çš„é…ç½®æ”¾åˆ°/usr/local/etc/nginx/nginx.confæ–‡ä»¶çš„server é‡Œ

## å¼€å¯ gzip å‹ç¼©
1. æ¥åˆ° .env.productionï¼Œå°† VITE_BUILD_COMPRESS ç­‰äº gzipï¼Œå¦‚ä¸‹
```bash
# æ˜¯å¦åœ¨æ‰“åŒ…æ—¶å¼€å¯å‹ç¼©ï¼Œæ”¯æŒ gzip å’Œ brotli
VITE_BUILD_COMPRESS = gzip
```
2. é…ç½® nginx.config å¦‚ä¸‹

```bash
http {
  # å¼€å¯gzip
  gzip on;
  # https://blog.csdn.net/fxss5201/article/details/106535475
  gzip_static on;
  gzip_proxied any;
  # ä½äº1kbçš„èµ„æºä¸å‹ç¼©
  gzip_min_length 1k;
  gzip_buffers 4 16k;
  gzip_comp_level 2;
  # éœ€è¦å‹ç¼©çš„ç±»å‹
  gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
  # é…ç½®ç¦ç”¨gzipæ¡ä»¶ï¼Œæ”¯æŒæ­£åˆ™ã€‚æ­¤å¤„è¡¨ç¤ºie6åŠä»¥ä¸‹ä¸å¯ç”¨gzipï¼ˆå› ä¸ºieä½ç‰ˆæœ¬ä¸æ”¯æŒï¼‰
  gzip_disable "MSIE [1-6]\.";
  # æ˜¯å¦æ·»åŠ â€œVary: Accept-Encodingâ€å“åº”å¤´
  gzip_vary off;
}
```
å¼€å¯ gzipï¼ˆèµ„æºè¢«å‹ç¼©åä¼šæ¯”æœªå¼€å¯æ—¶å°å¾ˆå¤š ğŸ®ï¼‰
